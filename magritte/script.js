var MagrittePresentationData = {

  // image paths relative to segments/

  // audio paths relative to audio/

  1: {

    title: 'Winding Back the Clock',
    thumbnail: 'thumb_1.jpg',
    audio: '1_stephanie_b1_128k.mp3',
    
    events: [
      {
        start: 0.1,
        end: 17,
        type: 'multi_image',
        images: [{
          src: "1/1-1.jpg",
          caption: "René Magritte. <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 18,
        end: 32,
        type: 'multi_image',
        images: [
          {
            src: "1/1-2.jpg",
            caption: "Norman Parkinson. Edward James on the grand staircase of 35 Wimpole Street, London, photographed for <em>Harper’s Bazaar</em>, late 1930s. Norman Parkinson Archive, London. © Norman Parkinson Limited/Courtesy Norman Parkinson Archive."
          },
          {
            src: "1/1-3.jpg",
            caption: "Norman Parkinson. Edward James with Rene Magritte's <em>The Future of Statues</em>, c. 1937. Edward James Foundation. © Norman Parkinson Limited/Hamiltons Photographers Limited."
          }
        ]
      },

      {
        start: 33,
        end: 38,
        type: 'multi_image',
        images: [{
          src: "1/1-7.jpg",
          caption: "Photographer unknown. <em>Magritte working in a temporary studio at 35 Wimpole Street, London</em>, Winter 1937. Location unknown, Banque d’Images, ADAGP/Art Resource, N.Y. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 39,
        end: 58,
        type: 'multi_image',
        images: [
          {
            src: "1/1-4.jpg",
            caption: "René Magritte. <em>The Red Model</em>, 1937. Museum Boijmans van Beuningen, Rotterdam. © Charly Herscovici–ADAGP–ARS, 2014.",
            class: "image-set image-smaller"
          },
          {
            src: "1/1-5.jpg",
            caption: "René Magritte. <em>On the Threshold of Liberty</em>, February-March 1937. The Art Institute of Chicago, Gift of Mary and Leigh Block. © Charly Herscovici–ADAGP–ARS, 2014.",
            class: "image-set"
          },
          {
            src: "1/1-6.jpg",
            caption: "René Magritte. <em>Youth Illustrated</em>, 1937. Museum Boijmans van Beuningen, Rotterdam. © Charly Herscovici–ADAGP–ARS, 2014.",
            class: "image-set image-smaller"
          }
        ]
      },

      {
        start: 59,
        type: 'multi_image',
        images: [{
          src: "1/1-1.jpg",
          caption: "René Magritte. <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 76,
        type: 'next_segment_button'
      }
    ]

  },

  2: {

    title: 'Passage of Time',
    thumbnail: 'thumb_2.jpg',
    audio: '2_allison_b1_128k.mp3', //

    events: [
      { 
        start: 0.1,
        end: 3,
        type: 'multi_image',
        images: [{
          src: "1/1-1.jpg",
          caption: "René Magritte. <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 4,
        end: 10,
        type: 'multi_image',
        images: [{
          src: "2/2-2.jpg",
          caption: "X-ray of <em>Time Transfixed</em>."
        }]
      },

      {
        start: 11,
        end: 19,
        type: 'multi_image',
        images: [{
          src: "2/2-3.jpg",
          caption: "X-ray of <em>Time Transfixed</em> with outline of original placement of the train (in red) and current placement (in green)."
        }]
      },

      {
        start: 20,
        end: 25,
        type: 'multi_image',
        images: [{
          src: "2/2-5.jpg",
          caption: "Transmitted infrared photograph of <em>Time Transfixed</em>."
        }]
      },

      {
        start: 26,
        end: 30,
        type: 'multi_image',
        images: [{
          src: "2/2-6b.jpg",
          caption: "Transmitted infrared photograph of <em>Time Transfixed</em> with outline of reclining male figure."
        }]
      },

      {
        start: 31,
        end: 45,
        type: 'multi_image',
        images: [{
          src: "2/2-6.jpg",
          caption: "Transmitted infrared photograph of <em>Time Transfixed</em> with outline of reclining male figure."
        }]
      },

      {
        start: 46,
        end: 63,
        type: 'multi_image',
        images: [{
          src: "2/2-7.jpg",
          caption: "Transmitted light photograph of <em>Time Transfixed</em> with outline of reclining male figure."
        }]
      },

      {
        start: 64,
        type: 'multi_image',
        images: [{
          src: "2/2-8.jpg",
          caption: "Detail of <em>Time Transfixed</em> showing head and shoulder of the reclining male figure. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 72,
        type: 'next_segment_button'
      }
    ]

  },

  3: {

    title: 'Father Time',
    thumbnail: 'thumb_3.jpg',
    audio: '3_stephanie_allison_b1_128k.mp3', //

    events: [
      {
        start: 0.1,
        end: 7,
        type: 'multi_image',
        images: [{
          src: "2/2-7.jpg",
          caption: "Transmitted light photograph of <em>Time Transfixed</em> with outline of reclining male figure."
        }]
      },

      {
        start: 8,
        end: 14,
        type: 'multi_image',
        images: [
          {
            src: "3/3-2.jpg",
            caption: "René Magritte. <em>Untitled (Study for “Spring Eternal”)</em>, c. 1937-38. Private Collection. © Charly Herscovici–ADAGP–ARS, 2014."
          },

          {
            src: "3/3-3.jpg",
            caption: "René Magritte. <em>Untitled (Study for “Spring Eternal”)</em>, c. 1937-38. Private Collection. © Charly Herscovici–ADAGP–ARS, 2014."
          }
        ]
      },

      {
        start: 15,
        end: 32,
        type: 'multi_image',
        images: [{
          src: "3/3-4.jpg",
          caption: "René Magritte. <em>Spring Eternal</em>, 1937 or 1938. Private Collection, Kuwait. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 33,
        end: 40,
        type: 'multi_image',
        images: [
          {
            src: "2/2-7.jpg",
            caption: "Transmitted light photograph of <em>Time Transfixed</em> with outline of reclining male figure."
          },

          {
            src: "3/3-7.jpg",
            caption: "René Magritte. <em>Untitled (Study for “Spring Eternal”)</em>, c. 1937-38. Private Collection. © Charly Herscovici–ADAGP–ARS, 2014. Overlayed on transmitted infrared image of René Magritte, <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
          }
        ]
      },

      {
        start: 41,
        type: 'multi_image',
        images: [{
          src: "3/3-7.jpg",
          caption: "René Magritte. <em>Untitled (Study for “Spring Eternal”)</em>, c. 1937-38. Private Collection. © Charly Herscovici–ADAGP–ARS, 2014. Overlayed on transmitted infrared image of René Magritte, <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 52,
        type: 'next_segment_button'
      }
    ]

  },

  4: {

    title: 'Time Warp',
    thumbnail: 'thumb_4.jpg',
    audio: '4_stephanie_b1_128k.mp3', //

    events: [
      {
        start: 0.1,
        end: 8,
        type: 'multi_image',
        images: [{
          src: "1/1-1.jpg",
          caption: "René Magritte. <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 9,
        end: 25,
        type: 'multi_image',
        images: [{
          src: "4/4-2.jpg",
          caption: '<em>René Magritte with “Time Transfixed,”</em> 1938. Reproduced in Patrick Roegiers, <em>Magritte et la Photographie</em> (Gand: Ludion, 2005), p. 97. © Charly Herscovici–ADAGP–ARS, 2014.'
        }]
      },

      {
        start: 26,
        end: 45,
        type: 'multi_image',
        images: [{
          src: "4/4-3.jpg",
          caption: "René Magritte, letter to Edward James, May 18, 1937. Edward James Foundation, West Dean. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 46,
        end: 68,
        type: 'multi_image',
        images: [{
          src: "4/4-4.jpg",
          caption: "René Magritte, letter to Edward James, July 12, 1939. Edward James Foundation, London. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      },

      {
        start: 69,
        end: 95,
        type: 'multi_image',
        images: [{
          src: "4/4-5.jpg",
          caption: "Clip from <em>The Last Gangster</em>, 1937. Directed by Edward Ludgin. © Metro-Goldwyn-Mayer."
        }]
      },

      {
        start: 81,
        end: 95,
        type: 'last_gangster_button'
      },

      {
        start: 96,
        type: 'multi_image',
        images: [{
          src: "1/1-1.jpg",
          caption: "René Magritte. <em>Time Transfixed</em>, 1938. The Art Institute of Chicago, Joseph Winterbotham Collection. © Charly Herscovici–ADAGP–ARS, 2014."
        }]
      }
    ]

  }

};

var Magritte = {

  current_segment: 0,

  ytplayer: null,

  ytplayer_visible: false,

  
  resize_splash_area: function() {
    var window_height = $(window).height(),
        header_height = $('.main-header').height(),
        title_height = $('.main-title').height(),
        splash_height = window_height - header_height - 75; // title not calculated yet

    $('.splash-image').height(splash_height);
  },
  

  initialize_all_segments: function() {
    $.each(MagrittePresentationData, function(num, segment_data) {
      Magritte.create_audio_player(num, segment_data.audio);

      if(typeof segment_data.events === 'undefined' || segment_data.events.length === 0) return;
      Magritte.register_popcorn_events('#segment-audio-player-' + num, segment_data.events);
    });

    Magritte.initialize_segment_selector();
  },


  initialize_segment_selector: function() {
    var selector_items = [];

    $.each(MagrittePresentationData, function(num, segment) {

      var selector_item = NAV({class: 'segment-thumb-container'},
        DIV({class: 'segment-thumb', 
             style: 'background-image:url("segments/' + segment.thumbnail + '");'},
          IMG({class: 'segment-play-button', src: 'segments/play.gif'})
        ),
        DIV({class: 'segment-thumb-label'}, num + '. ' + segment.title)
      );

      $(selector_item).click(function() {
        // pause and reset all audio players
        $.each(document.getElementsByTagName('audio'), function(k, p) {
          p.pause();
          p.currentTime = 0;
        });

        // update thumbnail selected indicators
        $('.segment-thumb-container').removeClass('active');
        $(this).addClass('active');

        // display presentation and scroll to it
        $('#presentation-container').css({display: 'block', opacity: 0});
        Magritte.scroll_to_presentation(function() {
          Magritte.activate_segment(num);
        });
      });

      selector_items.push(selector_item);

    });

    // create selector
    $('#media-selector').html(selector_items);

    // create handler for next-segment-button
    $('#next-segment-button').on('click', function() {
      // since the segment #'s are not zero indexed, and the array of thumbs are...
      // the current segment # can be used as the index of the next segment thumb
      $('.segment-thumb-container')[Magritte.current_segment].click();
      $('#next-segment-button').css('display', 'none');
    });
  },


  activate_segment: function(num) {
    Magritte.current_segment = num;
    $('.segment-audio-player, .next-segment-button').css('display', 'none');

    // redundant selectors, but I can't get the html5 audio controls to work with jquery
    $('#segment-audio-player-' + num).css('display', 'block');
    document.getElementById('segment-audio-player-' + num).play();
  },


  create_audio_player: function(num, audio_file) {
    $('#segment-audio-player-container').append(
      AUDIO({
        id: 'segment-audio-player-' + num, 
        class: 'segment-audio-player', 
        controls: 'controls'
      }, SOURCE({src: 'audio/' + audio_file, type: 'audio/mp3'}))
    );
  },


  scroll_to_presentation: function(callback) {
    $('html, body').animate({
      scrollTop: $('#presentation-container').offset().top
    }, 1000, callback); 
  },


  register_popcorn_events: function(target, events) {
    var popcorn = Popcorn(target);

    if(events.length === 0) return;

    $.each(events, function(k, e) {

      // update image src's with full paths
      if(typeof e.images !== 'undefined') {
        $.each(e.images, function(k, i) {
          var full_path = 'segments/' + i.src;
          e.images[k].src  = full_path;
        });
      }

      popcorn[e.type](e);
    });
  },


  load_youtube_api: function() {
    var tag = document.createElement('script');
    tag.src = 'https://www.youtube.com/iframe_api';
    var first_script_tag = document.getElementsByTagName('script')[0];
    first_script_tag.parentNode.insertBefore(tag, first_script_tag);
  },


  on_player_ready: function(event) {
    // check for autoplay query string
    var autoplay = Magritte.get_parameter_by_name('autoplay');
  
    // if autoplay variable set, play video
    if(autoplay) {
      Magritte.scrollto_and_autoplay_video();
    }
  },


  play_youtube_video: function() {
    $('#youtube-player').css('visibility','visible');
    $('#play-video-image').css('visibility','hidden');
    Magritte.ytplayer.playVideo();  
  },


  on_player_state_change: function(event) {
    if(event.data == YT.PlayerState.ENDED) {
      $('#youtube-player').css('visibility','hidden');
      $('#play-video-image').css('visibility','visible');
    }
  },


  get_parameter_by_name: function(name) {
    var clean_name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"),
        regex = new RegExp("[\\?&]" + clean_name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  },


  scrollto_and_autoplay_video: function() {
    if( $('#play-video-image').length) {
      $('html, body').animate({
        scrollTop: $('#play-video-image').offset().top
      }, 1000, Magritte.play_youtube_video()); 
    } 
  }

};

// YouTube API callback
function onYouTubeIframeAPIReady() {
  Magritte.ytplayer = new YT.Player('youtube-player', {
    height: 480,
    width: 640,
    videoId: '4C98Wz96-fw',
    events: {
      'onReady': Magritte.on_player_ready,
      'onStateChange': Magritte.on_player_state_change

    }
  });
}

$(window).load(function() {
  Magritte.resize_splash_area();
  $(window).resize(Magritte.resize_splash_area);
  Magritte.load_youtube_api();
  $(document).foundation();
  $('#play-video-image').click(function(e) {
    Magritte.play_youtube_video();
    e.preventDefault();
  });
});
